
==============================
ğŸ”’ GEO PORTEIL - SÃ‰CURITÃ‰ BACKEND
==============================

Vue d'ensemble :
---------------
Cette documentation rÃ©sume les principales **mesures de sÃ©curitÃ©** mises en place dans le projet **GeoPorteil** pour protÃ©ger lâ€™application contre les attaques courantes, garantir la confidentialitÃ© des donnÃ©es et respecter les bonnes pratiques.

ğŸ›¡ï¸ 1. Protection Anti-Brute Force 
---------------------------------
ğŸ“ Fichier : backend/middleware/loginLimiter.js  
ğŸ¯ Objectif : Limiter les tentatives de connexion pour prÃ©venir les attaques par force brute.

```js
const loginLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutes
  max: 5, // 5 tentatives par IP
  keyGenerator: (req) => `${req.ip}-${req.body.email || 'unknown'}`,
  skipSuccessfulRequests: true
});
```

âœ… FonctionnalitÃ©s :
- 5 tentatives max par IP/email toutes les 15 min
- ClÃ© = IP + email â†’ contrÃ´le plus prÃ©cis
- Les tentatives rÃ©ussies ne sont pas comptÃ©es
- En-tÃªtes HTTP informatifs

ğŸ›¡ ProtÃ¨ge contre :
- Dictionnaires
- Brute force
- Bots automatisÃ©s

ğŸ“Š 2. SystÃ¨me de Logs de SÃ©curitÃ©
-------------------------------
ğŸ“ Fichier : backend/middleware/securityLogger.js  
ğŸ¯ Objectif : Journaliser toutes les activitÃ©s de sÃ©curitÃ© pour audit et dÃ©tection.

ğŸ“˜ Types dâ€™Ã©vÃ©nements :
| Ã‰vÃ©nement            | Description                         | DonnÃ©es capturÃ©es                          |
|----------------------|-------------------------------------|--------------------------------------------|
| LOGIN_ATTEMPT        | Tentative de connexion              | Email, IP, User-Agent, succÃ¨s/Ã©chec        |
| LOGIN_SUCCESS        | Connexion rÃ©ussie                   | UserID, IP, timestamp                       |
| LOGIN_FAILURE        | Connexion Ã©chouÃ©e                   | Email, IP, raison                          |
| SUSPICIOUS_ACTIVITY  | ActivitÃ© suspecte dÃ©tectÃ©e          | Type, dÃ©tails                              |
| ADMIN_ACTION         | Action dâ€™un admin                   | AdminID, action, cible, IP                 |

ğŸ“„ Format :
{
  "timestamp": "2024-12-14T10:30:00.000Z",
  "event": "LOGIN_FAILURE",
  "email": "user@example.com",
  "ip": "192.168.1.100",
  "userAgent": "Mozilla/5.0...",
  "reason": "INVALID_PASSWORD"
}

ğŸ—‚ï¸ Stockage : `backend/logs/security.log`  
ğŸ” Rotation des logs : Ã€ implÃ©menter

ğŸ” 3. Chiffrement des Mots de Passe
----------------------------------
ğŸ“ Fichier : backend/models/User.js  
ğŸ¯ Objectif : Stocker les mots de passe de maniÃ¨re sÃ©curisÃ©e

userSchema.pre('save', async function(next) {
  if (!this.isModified('password')) return next();
  this.password = await bcrypt.hash(this.password, 12);
  next();
});

âœ… SpÃ©cifications :
- bcrypt avec 12 salt rounds
- Hash automatique avant sauvegarde
- MÃ©thode `comparePassword()` pour vÃ©rification

ğŸš« ProtÃ¨ge contre : avec bcrypt 
- Vol de DB (utilisation de bcrypt  pour rendre les mots de passe inutilisables mÃªme volÃ©s.)
- Rainbow tables (tableau avec des milliers de mots de passe hachÃ©s pour retrouver les mots de passe originaux.)
- Reverse engineering (deviner le mot de passe Ã  partir du hash)

ğŸ” 4. ContrÃ´le dâ€™AccÃ¨s aux Fichiers
----------------------------------
ğŸ“ Fichier : backend/middleware/fileAccessControl.js  
ğŸ¯ Objectif : Bloquer lâ€™accÃ¨s aux fichiers sensibles

ğŸ“Œ Fichiers/Dossiers protÃ©gÃ©s :
const forbiddenPaths = [
  '/.env', '/config/', '/logs/', '/.git/', '/node_modules/',
  '/package.json', '/package-lock.json'
];

ğŸ“Œ Extensions interdites :
const forbiddenExtensions = ['.env', '.log', '.key', '.pem', '.p12'];

ğŸ” DÃ©tection :
- Directory Traversal (`../`)
- Injection de chemins
- Log de toute tentative

ğŸ§± ProtÃ¨ge contre :
- LFI (local file inclusion) : (quand quelqu'un tente d'accÃ©der Ã  un fichier privÃ© en manipulant l'URL)
- Vol de config ou clÃ©s privÃ©es (une  middleware qui interdit l'accÃ©s au fichier sensible)

ğŸ›¡ï¸ 5. Headers de SÃ©curitÃ© HTTP
------------------------------
ğŸ“ ImplÃ©mentÃ© dans `server.js` avec Helmet

app.use(helmet());

âœ… Headers activÃ©s :
- X-Content-Type-Options       â†’ EmpÃªche le sniffing MIME (dÃ©termination du type de contenu d'un fichier)
- X-Frame-Options: DENY        â†’ Contre le clickjacking  (affichage d'un site web dans un iframe sur un autre site)
- X-XSS-Protection             â†’ Contre les attaques XSS simples
- Strict-Transport-Security    â†’ Force lâ€™usage de HTTPS
- Content-Security-Policy      â†’ ContrÃ´le les ressources chargÃ©es

ğŸ§¼ 6. Validation et Nettoyage des EntrÃ©es
----------------------------------------
ğŸ“ Fichier : backend/routes/authRoutes.js

const validateLogin = [
  body('email').isEmail().normalizeEmail(),
  body('password').isLength({ min: 6 })
];

âœ… Validations :
- Email : format + normalisation
- Password : minimum 6 caractÃ¨res
- Sanitisation automatique

ğŸ” 7. Monitoring & Alertes
--------------------------
ğŸ“ Fichier : authController.js  
ğŸ¯ Log automatique des tentatives :

await securityLogger.logLoginFailure(email, ip, userAgent, 'INVALID_PASSWORD');
await securityLogger.logLoginSuccess(user._id, email, ip, userAgent);

ğŸ“Œ Infos loggÃ©es :
- IP utilisateur
- Navigateur (User-Agent)
- Timestamp
- ID utilisateur (si succÃ¨s)

âš™ï¸ 8. Configuration de SÃ©curitÃ©
------------------------------
ğŸ“ `.env` ou variables dâ€™environnement

# Auth
JWT_SECRET= token 
JWT_EXPIRES=2d

# Base de donnÃ©es
MONGO_URI=mongodb://127.0.0.1:27017/geoporteil

# Email (si utilisÃ©)
ADMIN_EMAIL=admin@geoporteil.com

# Environnement
NODE_ENV=production

âœ… Bonnes pratiques :
- Utiliser une `JWT_SECRET` longue et complexe
- Forcer HTTPS
- CORS strict
- Limiter taille des requÃªtes

ğŸ“‹ 9. Checklist de SÃ©curitÃ©
--------------------------
âœ… ImplÃ©mentÃ© :
- [x] Hash bcrypt mots de passe
- [x] Rate limiting login/signup
- [x] Logs sÃ©curitÃ©
- [x] ContrÃ´le fichiers sensibles
- [x] Headers de sÃ©curitÃ©
- [x] Validation entrÃ©es
- [x] JWT + Auth middleware

ğŸ”„ AmÃ©liorations Ã  venir :
- [ ] Rotation automatique des logs
- [ ] Alertes email
- [ ] Blacklist IPs
- [ ] Audit trail admin
- [ ] Chiffrement base de donnÃ©es
- [ ] Backups sÃ©curisÃ©s

ğŸš¨ 10. RÃ©ponse aux Incidents
---------------------------
ğŸ“Œ Actions Ã  suivre :
1. VÃ©rifier les logs :
tail -f backend/logs/security.log

2. Identifier les IP suspectes :
grep "LOGIN_FAILURE" backend/logs/security.log | jq -r '.ip' | sort | uniq -c

3. Voir activitÃ©s suspectes :
grep "SUSPICIOUS_ACTIVITY" backend/logs/security.log

ğŸ›‘ En cas d'attaque :
- Analyser logs
- Identifier lâ€™impact
- Bloquer IP (blacklist)

ğŸ“Š 11. MÃ©triques de SÃ©curitÃ©
---------------------------
KPIs Ã  surveiller :
- Nombre de tentatives Ã©chouÃ©es / jour
- IPs avec +10 tentatives / heure
- Tentatives dâ€™accÃ¨s Ã  fichiers sensibles
- Taux de succÃ¨s login
- RÃ©ponse API sur endpoints critiques


